<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <title>Document</title>
</head>
<body>
    <h2>Cho mượn thiết bị</h2>

    <div>
        <input type="text"
               placeholder="Nhập mã thành viên"
               id="tv-id-input">

        <button id="find-tv">Tìm</button>

        <div class="tv-message">

        </div>

        <input type="text"
               placeholder="Nhập mã thiết bị"
                id="tb-id-input"
        >
        <button id="find-tb">Tìm</button>

        <div class="tb-message">

        </div>

        <button id="rent-btn">Cho mượn</button>

    </div>

    <div class="message">

    </div>

    <script>

        //khai báo 2 biến để lưu điều kiện tìm kiếm
        var tvCanRent = false;
        var tbCanRent = false;

        //xử lý tìm thành viên
        $(document).ready(function (){
            $('#find-tv').click(function() {
                var tvId = $('#tv-id-input').val();
                $.ajax({
                    url: '/ttsd/findTV',
                    type: 'POST',
                    data: {
                        TvId: tvId
                    },
                    success: function(response) {
                        let html = '<div>';

                        if(response.status !== 'error'){
                            html += '<p>' + response.info + '</p>';
                            html += '<p>' + response.message + '</p>';
                            tvCanRent = true;
                        }
                        else{
                            html += '<p>' + response.message + '</p>';
                        }

                        html += '</div>';
                        $('.tv-message').html(html);

                        if(response.status !== 'success'){
                            tvCanRent = false;
                        }
                    },
                    error: function(error) {
                        console.log(error);
                    }
                });
            });
        });

        //xử lý tìm thiết bị
        $(document).ready(function (){
            $('#find-tb').click(function() {
                var tbId = $('#tb-id-input').val();
                $.ajax({
                    url: '/ttsd/findTB',
                    type: 'POST',
                    data: {
                        TbId: tbId
                    },
                    success: function(response) {
                        let html = '<div>';

                        if(response.status !== 'error'){
                            html += '<p>' + response.info + '</p>';
                            html += '<p>' + response.message + '</p>';
                            tbCanRent = true;
                        }
                        else{
                            html += '<p>' + response.message + '</p>';
                        }

                        html += '</div>';
                        $('.tb-message').html(html);

                        if(response.status !== 'success'){
                            tbCanRent = false;
                        }

                    },
                    error: function(error) {
                        console.log(error);
                    }
                });
            });
        });

        // xử lý cho mượn
        $(document).ready(function (){
            //kiểm tra điều kiện trước khi cho mượn
                $('#rent-btn').click(function() {
                    // if(tvCanRent === true && tbCanRent === true){
                        var tvId = $('#tv-id-input').val();
                        var tbId = $('#tb-id-input').val();
                        $.ajax({
                            url: '/ttsd/borrow',
                            type: 'POST',
                            data: {
                                TvId: tvId,
                                TbId: tbId
                            },
                            success: function(response) {
                                let html = '<div>';

                                html += '<p>' + response.rentResponse.status + '</p>';
                                html += '<p>' + response.rentResponse.message + '</p>';

                                html += '</div>';

                                $('.message').html(html);

                                if(response.rentResponse.status === 'success'){
                                    alert('Cho mượn thành công')
                                }
                                else{
                                    alert('Cho mượn thất bại')
                                }

                                //xử lý báo lỗi cho thit bị
                                let tbHtml = '<div>';
                                if(response.tbResponse.status !== 'error'){
                                    tbHtml += '<p>' + response.tbResponse.info + '</p>';
                                    tbHtml += '<p>' + response.tbResponse.message + '</p>';
                                }
                                else{
                                    tbHtml += '<p>' + response.tbResponse.message + '</p>';
                                }
                                tbHtml += '</div>';
                                $('.tb-message').html(tbHtml);

                                //xử lý báo lỗi cho thành viên
                                let tvHtml = '<div>';
                                if(response.tvResponse.status !== 'error'){
                                    tvHtml += '<p>' + response.tvResponse.info + '</p>';
                                    tvHtml += '<p>' + response.tvResponse.message + '</p>';
                                }
                                else{
                                    tvHtml += '<p>' + response.tvResponse.message + '</p>';
                                }
                                tvHtml += '</div>';
                                $('.tv-message').html(tvHtml);

                                console.log(response);

                            },
                            error: function(error) {
                                console.log(error);
                            }
                        });
                    // }
                    // else{
                    //     alert('Vui lòng điền đầy đủ thông tin và hợp lệ')
                    // }
                });

        });
    </script>
</body>
</html>